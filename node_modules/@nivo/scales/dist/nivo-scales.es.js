import n from"lodash/uniq";import t from"lodash/uniqBy";import r from"lodash/sortBy";import e from"lodash/last";import a from"lodash/isDate";import{utcParse as i,timeParse as o}from"d3-time-format";import{scaleLinear as u,scalePoint as c,scaleBand as d,scaleUtc as f,scaleTime as s,scaleLog as l,scaleSymlog as m}from"d3-scale";import{timeInterval as v,timeMillisecond as y,utcMillisecond as p,timeSecond as h,utcSecond as g,timeMinute as x,utcMinute as k,timeHour as T,utcHour as M,timeWeek as w,utcWeek as b,timeSunday as E,utcSunday as S,timeMonday as D,utcMonday as C,timeTuesday as U,utcTuesday as j,timeWednesday as O,utcWednesday as R,timeThursday as H,utcThursday as V,timeFriday as q,utcFriday as A,timeSaturday as B,utcSaturday as F,timeMonth as N,utcMonth as z,timeYear as I,utcYear as P}from"d3-time";function $(){return $=Object.assign||function(n){for(var t=1;t<arguments.length;t++){var r=arguments[t];for(var e in r)Object.prototype.hasOwnProperty.call(r,e)&&(n[e]=r[e])}return n},$.apply(this,arguments)}var G=["millisecond","second","minute","hour","day","month","year"],J=[function(n){return n.setMilliseconds(0)},function(n){return n.setSeconds(0)},function(n){return n.setMinutes(0)},function(n){return n.setHours(0)},function(n){return n.setDate(1)},function(n){return n.setMonth(0)}],K={millisecond:[],second:J.slice(0,1),minute:J.slice(0,2),hour:J.slice(0,3),day:J.slice(0,4),month:J.slice(0,5),year:J.slice(0,6)},L=function(n){return function(t){return K[n].forEach((function(n){n(t)})),t}},Q=function(n){var t=n.format,r=void 0===t?"native":t,e=n.precision,a=void 0===e?"millisecond":e,u=n.useUTC,c=void 0===u||u,d=L(a);return function(n){if(void 0===n)return n;if("native"===r||n instanceof Date)return d(n);var t=c?i(r):o(r);return d(t(n))}},W=function(n,t,r,e){var a,i,o,c,d=n.min,f=void 0===d?0:d,s=n.max,l=void 0===s?"auto":s,m=n.stacked,v=void 0!==m&&m,y=n.reverse,p=void 0!==y&&y,h=n.clamp,g=void 0!==h&&h,x=n.nice,k=void 0!==x&&x;"auto"===f?a=!0===v?null!=(i=t.minStacked)?i:0:t.min:a=f;"auto"===l?o=!0===v?null!=(c=t.maxStacked)?c:0:t.max:o=l;var T=u().rangeRound("x"===e?[0,r]:[r,0]).domain(p?[o,a]:[a,o]).clamp(g);return!0===k?T.nice():"number"==typeof k&&T.nice(k),X(T,v)},X=function(n,t){void 0===t&&(t=!1);var r=n;return r.type="linear",r.stacked=t,r},Y=function(n,t,r){var e=c().range([0,r]).domain(t.all);return e.type="point",e},Z=function(n,t,r,e){var a=n.round,i=void 0===a||a,o=d().range("x"===e?[0,r]:[r,0]).domain(t.all).round(i);return _(o)},_=function(n){var t=n;return t.type="band",t},nn=function(n,t,r){var e,a,i=n.format,o=void 0===i?"native":i,u=n.precision,c=void 0===u?"millisecond":u,d=n.min,l=void 0===d?"auto":d,m=n.max,v=void 0===m?"auto":m,y=n.useUTC,p=void 0===y||y,h=n.nice,g=void 0!==h&&h,x=Q({format:o,precision:c,useUTC:p});e="auto"===l?x(t.min):"native"!==o?x(l):l,a="auto"===v?x(t.max):"native"!==o?x(v):v;var k=p?f():s();k.range([0,r]),e&&a&&k.domain([e,a]),!0===g?k.nice():"object"!=typeof g&&"number"!=typeof g||k.nice(g);var T=k;return T.type="time",T.useUTC=p,T},tn=function(n,t,r,e){var a,i=n.base,o=void 0===i?10:i,u=n.min,c=void 0===u?"auto":u,d=n.max,f=void 0===d?"auto":d;if(t.all.some((function(n){return 0===n})))throw new Error("a log scale domain must not include or cross zero");var s,m,v=!1;if(t.all.filter((function(n){return null!=n})).forEach((function(n){v||(void 0===a?a=Math.sign(n):Math.sign(n)!==a&&(v=!0))})),v)throw new Error("a log scale domain must be strictly-positive or strictly-negative");s="auto"===c?t.min:c,m="auto"===f?t.max:f;var y=l().domain([s,m]).rangeRound("x"===e?[0,r]:[r,0]).base(o).nice();return y.type="log",y},rn=function(n,t,r,e){var a,i,o=n.constant,u=void 0===o?1:o,c=n.min,d=void 0===c?"auto":c,f=n.max,s=void 0===f?"auto":f,l=n.reverse,v=void 0!==l&&l;a="auto"===d?t.min:d,i="auto"===s?t.max:s;var y=m().constant(u).rangeRound("x"===e?[0,r]:[r,0]).nice();!0===v?y.domain([i,a]):y.domain([a,i]);var p=y;return p.type="symlog",p},en=function(n){return"x"===n?"y":"x"},an=function(n,t){return n===t},on=function(n,t){return n.getTime()===t.getTime()};function un(n,t,r,e){switch(n.type){case"linear":return W(n,t,r,e);case"point":return Y(0,t,r);case"band":return Z(n,t,r,e);case"time":return nn(n,t,r);case"log":return tn(n,t,r,e);case"symlog":return rn(n,t,r,e);default:throw new Error("invalid scale spec")}}var cn=function(n,t,r){var e;if("stacked"in r&&r.stacked){var a=n.data["x"===t?"xStacked":"yStacked"];return null==a?null:r(a)}return null!=(e=r(n.data[t]))?e:null},dn=function(n,t,r,e,a){var i=n.map((function(n){return function(n){return $({},n,{data:n.data.map((function(n){return{data:$({},n)}}))})}(n)})),o=fn(i,t,r);"stacked"in t&&!0===t.stacked&&mn(o,i),"stacked"in r&&!0===r.stacked&&vn(o,i);var u=un(t,o.x,e,"x"),c=un(r,o.y,a,"y"),d=i.map((function(n){return $({},n,{data:n.data.map((function(n){return $({},n,{position:{x:cn(n,"x",u),y:cn(n,"y",c)}})}))})}));return $({},o,{series:d,xScale:u,yScale:c})},fn=function(n,t,r){return{x:sn(n,"x",t),y:sn(n,"y",r)}},sn=function(a,i,o,u){var c=void 0===u?{}:u,d=c.getValue,f=void 0===d?function(n){return n.data[i]}:d,s=c.setValue,l=void 0===s?function(n,t){n.data[i]=t}:s;if("linear"===o.type)a.forEach((function(n){n.data.forEach((function(n){var t=f(n);t&&l(n,parseFloat(String(t)))}))}));else if("time"===o.type&&"native"!==o.format){var m=Q(o);a.forEach((function(n){n.data.forEach((function(n){var t=f(n);t&&l(n,m(t))}))}))}var v=[];switch(a.forEach((function(n){n.data.forEach((function(n){v.push(f(n))}))})),o.type){case"linear":var y=r(n(v).filter((function(n){return null!==n})),(function(n){return n}));return{all:y,min:Math.min.apply(Math,y),max:Math.max.apply(Math,y)};case"time":var p=t(v,(function(n){return n.getTime()})).slice(0).sort((function(n,t){return t.getTime()-n.getTime()})).reverse();return{all:p,min:p[0],max:e(p)};default:var h=n(v);return{all:h,min:h[0],max:e(h)}}},ln=function(n,t,r){var i=en(n),o=[];t[i].all.forEach((function(t){var u=a(t)?on:an,c=[];r.forEach((function(r){var a=r.data.find((function(n){return u(n.data[i],t)})),d=null,f=null;if(void 0!==a){if(null!==(d=a.data[n])){var s=e(c);void 0===s?f=d:null!==s&&(f=s+d)}a.data["x"===n?"xStacked":"yStacked"]=f}c.push(f),null!==f&&o.push(f)}))})),t[n].minStacked=Math.min.apply(Math,o),t[n].maxStacked=Math.max.apply(Math,o)},mn=function(n,t){return ln("x",n,t)},vn=function(n,t){return ln("y",n,t)},yn=function(n){var t=n.bandwidth();if(0===t)return n;var r=t/2;return n.round()&&(r=Math.round(r)),function(t){var e;return(null!=(e=n(t))?e:0)+r}},pn={millisecond:[y,p],second:[h,g],minute:[x,k],hour:[T,M],day:[v((function(n){return n.setHours(0,0,0,0)}),(function(n,t){return n.setDate(n.getDate()+t)}),(function(n,t){return(t.getTime()-n.getTime())/864e5}),(function(n){return Math.floor(n.getTime()/864e5)})),v((function(n){return n.setUTCHours(0,0,0,0)}),(function(n,t){return n.setUTCDate(n.getUTCDate()+t)}),(function(n,t){return(t.getTime()-n.getTime())/864e5}),(function(n){return Math.floor(n.getTime()/864e5)}))],week:[w,b],sunday:[E,S],monday:[D,C],tuesday:[U,j],wednesday:[O,R],thursday:[H,V],friday:[q,A],saturday:[B,F],month:[N,z],year:[I,P]},hn=Object.keys(pn),gn=new RegExp("^every\\s*(\\d+)?\\s*("+hn.join("|")+")s?$","i"),xn=function(n,t){if(Array.isArray(t))return t;if("string"==typeof t&&"useUTC"in n){var r=t.match(gn);if(r){var e=r[1],a=r[2],i=pn[a][n.useUTC?1:0];if("day"===a){var o,u,c=n.domain(),d=c[0],f=c[1],s=new Date(f);return s.setDate(s.getDate()+1),null!=(o=null==(u=i.every(Number(null!=e?e:1)))?void 0:u.range(d,s))?o:[]}if(void 0===e)return n.ticks(i);var l=i.every(Number(e));if(l)return n.ticks(l)}throw new Error("Invalid tickValues: "+t)}if("ticks"in n){if(void 0===t)return n.ticks();if("number"==typeof(m=t)&&isFinite(m)&&Math.floor(m)===m)return n.ticks(t)}var m;return n.domain()};export{_ as castBandScale,X as castLinearScale,yn as centerScale,on as compareDateValues,an as compareValues,un as computeScale,dn as computeXYScalesForSeries,Z as createBandScale,Q as createDateNormalizer,W as createLinearScale,tn as createLogScale,Y as createPointScale,L as createPrecisionMethod,rn as createSymlogScale,nn as createTimeScale,sn as generateSeriesAxis,fn as generateSeriesXY,en as getOtherAxis,xn as getScaleTicks,J as precisionCutOffs,K as precisionCutOffsByType,ln as stackAxis,G as timePrecisions};
//# sourceMappingURL=nivo-scales.es.js.map
