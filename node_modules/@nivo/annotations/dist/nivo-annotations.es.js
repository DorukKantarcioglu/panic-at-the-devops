import{isValidElement as t,useMemo as n,createElement as o}from"react";import i from"lodash/omit";import e from"lodash/isNumber";import a from"lodash/filter";import{absoluteAngleDegrees as r,radiansToDegrees as s,positionFromAngle as l,degreesToRadians as u,useTheme as h,useMotionConfig as d,useAnimatedPath as c}from"@nivo/core";import{useSpring as f,animated as y}from"@react-spring/web";import{jsxs as m,Fragment as x,jsx as g}from"react/jsx-runtime";function k(){return k=Object.assign||function(t){for(var n=1;n<arguments.length;n++){var o=arguments[n];for(var i in o)Object.prototype.hasOwnProperty.call(o,i)&&(t[i]=o[i])}return t},k.apply(this,arguments)}var p={dotSize:4,noteWidth:120,noteTextOffset:8,animate:!0,motionStiffness:90,motionDamping:13},W=function(n){var o=typeof n;return t(n)||"string"===o||"function"===o||"object"===o},v=function(t){var n=typeof t;return"string"===n||"function"===n},b=function(t){return"circle"===t.type},w=function(t){return"dot"===t.type},z=function(t){return"rect"===t.type},P=function(t){var n=t.data,o=t.annotations,e=t.getPosition,r=t.getDimensions;return o.reduce((function(t,o){var s=o.offset||0;return[].concat(t,a(n,o.match).map((function(t){var n=e(t),a=r(t);return(b(o)||z(o))&&(a.size=a.size+2*s,a.width=a.width+2*s,a.height=a.height+2*s),k({},i(o,["match","offset"]),n,a,{size:o.size||a.size,datum:t})})))}),[])},S=function(t,n,o,i){var e=Math.atan2(i-n,o-t);return r(s(e))},C=function(t){var n,o,i=t.x,a=t.y,r=t.noteX,s=t.noteY,h=t.noteWidth,d=void 0===h?p.noteWidth:h,c=t.noteTextOffset,f=void 0===c?p.noteTextOffset:c;if(e(r))n=i+r;else{if(void 0===r.abs)throw new Error("noteX should be either a number or an object containing an 'abs' property");n=r.abs}if(e(s))o=a+s;else{if(void 0===s.abs)throw new Error("noteY should be either a number or an object containing an 'abs' property");o=s.abs}var y=i,m=a,x=S(i,a,n,o);if(b(t)){var g=l(u(x),t.size/2);y+=g.x,m+=g.y}if(z(t)){var k=Math.round((x+90)/45)%8;0===k&&(m-=t.height/2),1===k&&(y+=t.width/2,m-=t.height/2),2===k&&(y+=t.width/2),3===k&&(y+=t.width/2,m+=t.height/2),4===k&&(m+=t.height/2),5===k&&(y-=t.width/2,m+=t.height/2),6===k&&(y-=t.width/2),7===k&&(y-=t.width/2,m-=t.height/2)}var W=n,v=n;return(x+90)%360>180?(W-=d,v-=d):v+=d,{points:[[y,m],[n,o],[v,o]],text:[W,o-f],angle:x+90}},O=function(t){var o=t.data,i=t.annotations,e=t.getPosition,a=t.getDimensions;return n((function(){return P({data:o,annotations:i,getPosition:e,getDimensions:a})}),[o,i,e,a])},j=function(t){var o=t.annotations;return n((function(){return o.map((function(t){return k({},t,{computed:C(k({},t))})}))}),[o])},M=function(t){return n((function(){return C(t)}),[t])},T=function(t){var n=t.datum,e=t.x,a=t.y,r=t.note,s=h(),l=d(),u=l.animate,c=l.config,p=f({x:e,y:a,config:c,immediate:!u});return"function"==typeof r?o(r,{x:e,y:a,datum:n}):m(x,{children:[s.annotations.text.outlineWidth>0&&g(y.text,{x:p.x,y:p.y,style:k({},s.annotations.text,{strokeLinejoin:"round",strokeWidth:2*s.annotations.text.outlineWidth,stroke:s.annotations.text.outlineColor}),children:r}),g(y.text,{x:p.x,y:p.y,style:i(s.annotations.text,["outlineWidth","outlineColor"]),children:r})]})},E=function(t){var o=t.points,i=t.isOutline,e=void 0!==i&&i,a=h(),r=n((function(){var t=o[0];return o.slice(1).reduce((function(t,n){return t+" L"+n[0]+","+n[1]}),"M"+t[0]+","+t[1])}),[o]),s=c(r);if(e&&a.annotations.link.outlineWidth<=0)return null;var l=k({},a.annotations.link);return e&&(l.strokeLinecap="square",l.strokeWidth=a.annotations.link.strokeWidth+2*a.annotations.link.outlineWidth,l.stroke=a.annotations.link.outlineColor),g(y.path,{fill:"none",d:s,style:l})},D=function(t){var n=t.x,o=t.y,i=t.size,e=h(),a=d(),r=a.animate,s=a.config,l=f({x:n,y:o,radius:i/2,config:s,immediate:!r});return m(x,{children:[e.annotations.outline.outlineWidth>0&&g(y.circle,{cx:l.x,cy:l.y,r:l.radius,style:k({},e.annotations.outline,{fill:"none",strokeWidth:e.annotations.outline.strokeWidth+2*e.annotations.outline.outlineWidth,stroke:e.annotations.outline.outlineColor})}),g(y.circle,{cx:l.x,cy:l.y,r:l.radius,style:e.annotations.outline})]})},I=function(t){var n=t.x,o=t.y,i=t.size,e=void 0===i?p.dotSize:i,a=h(),r=d(),s=r.animate,l=r.config,u=f({x:n,y:o,radius:e/2,config:l,immediate:!s});return m(x,{children:[a.annotations.outline.outlineWidth>0&&g(y.circle,{cx:u.x,cy:u.y,r:u.radius,style:k({},a.annotations.outline,{fill:"none",strokeWidth:2*a.annotations.outline.outlineWidth,stroke:a.annotations.outline.outlineColor})}),g(y.circle,{cx:u.x,cy:u.y,r:u.radius,style:a.annotations.symbol})]})},L=function(t){var n=t.x,o=t.y,i=t.width,e=t.height,a=h(),r=d(),s=r.animate,l=r.config,u=f({x:n-i/2,y:o-e/2,width:i,height:e,config:l,immediate:!s});return m(x,{children:[a.annotations.outline.outlineWidth>0&&g(y.rect,{x:u.x,y:u.y,width:u.width,height:u.height,style:k({},a.annotations.outline,{fill:"none",strokeWidth:a.annotations.outline.strokeWidth+2*a.annotations.outline.outlineWidth,stroke:a.annotations.outline.outlineColor})}),g(y.rect,{x:u.x,y:u.y,width:u.width,height:u.height,style:a.annotations.outline})]})},q=function(t){var n=t.datum,o=t.x,i=t.y,e=t.note,a=M(t);if(!W(e))throw new Error("note should be a valid react element");return m(x,{children:[g(E,{points:a.points,isOutline:!0}),b(t)&&g(D,{x:o,y:i,size:t.size}),w(t)&&g(I,{x:o,y:i,size:t.size}),z(t)&&g(L,{x:o,y:i,width:t.width,height:t.height}),g(E,{points:a.points}),g(T,{datum:n,x:a.text[0],y:a.text[1],note:e})]})},J=function(t,n){n.forEach((function(n,o){var i=n[0],e=n[1];0===o?t.moveTo(i,e):t.lineTo(i,e)}))},X=function(t,n){var o=n.annotations,i=n.theme;0!==o.length&&(t.save(),o.forEach((function(n){if(!v(n.note))throw new Error("note is invalid for canvas implementation");i.annotations.link.outlineWidth>0&&(t.lineCap="square",t.strokeStyle=i.annotations.link.outlineColor,t.lineWidth=i.annotations.link.strokeWidth+2*i.annotations.link.outlineWidth,t.beginPath(),J(t,n.computed.points),t.stroke(),t.lineCap="butt"),b(n)&&i.annotations.outline.outlineWidth>0&&(t.strokeStyle=i.annotations.outline.outlineColor,t.lineWidth=i.annotations.outline.strokeWidth+2*i.annotations.outline.outlineWidth,t.beginPath(),t.arc(n.x,n.y,n.size/2,0,2*Math.PI),t.stroke()),w(n)&&i.annotations.symbol.outlineWidth>0&&(t.strokeStyle=i.annotations.symbol.outlineColor,t.lineWidth=2*i.annotations.symbol.outlineWidth,t.beginPath(),t.arc(n.x,n.y,n.size/2,0,2*Math.PI),t.stroke()),z(n)&&i.annotations.outline.outlineWidth>0&&(t.strokeStyle=i.annotations.outline.outlineColor,t.lineWidth=i.annotations.outline.strokeWidth+2*i.annotations.outline.outlineWidth,t.beginPath(),t.rect(n.x-n.width/2,n.y-n.height/2,n.width,n.height),t.stroke()),t.strokeStyle=i.annotations.link.stroke,t.lineWidth=i.annotations.link.strokeWidth,t.beginPath(),J(t,n.computed.points),t.stroke(),b(n)&&(t.strokeStyle=i.annotations.outline.stroke,t.lineWidth=i.annotations.outline.strokeWidth,t.beginPath(),t.arc(n.x,n.y,n.size/2,0,2*Math.PI),t.stroke()),w(n)&&(t.fillStyle=i.annotations.symbol.fill,t.beginPath(),t.arc(n.x,n.y,n.size/2,0,2*Math.PI),t.fill()),z(n)&&(t.strokeStyle=i.annotations.outline.stroke,t.lineWidth=i.annotations.outline.strokeWidth,t.beginPath(),t.rect(n.x-n.width/2,n.y-n.height/2,n.width,n.height),t.stroke()),"function"==typeof n.note?n.note(t,{datum:n.datum,x:n.computed.text[0],y:n.computed.text[1],theme:i}):(t.font=i.annotations.text.fontSize+"px "+i.annotations.text.fontFamily,t.fillStyle=i.annotations.text.fill,t.strokeStyle=i.annotations.text.outlineColor,t.lineWidth=2*i.annotations.text.outlineWidth,i.annotations.text.outlineWidth>0&&(t.lineJoin="round",t.strokeText(n.note,n.computed.text[0],n.computed.text[1]),t.lineJoin="miter"),t.fillText(n.note,n.computed.text[0],n.computed.text[1]))})),t.restore())};export{q as Annotation,P as bindAnnotations,C as computeAnnotation,p as defaultProps,S as getLinkAngle,v as isCanvasNote,b as isCircleAnnotation,w as isDotAnnotation,z as isRectAnnotation,W as isSvgNote,X as renderAnnotationsToCanvas,O as useAnnotations,M as useComputedAnnotation,j as useComputedAnnotations};
//# sourceMappingURL=nivo-annotations.es.js.map
