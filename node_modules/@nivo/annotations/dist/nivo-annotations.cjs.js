"use strict";Object.defineProperty(exports,"__esModule",{value:!0});var t=require("react"),n=require("lodash/omit"),e=require("lodash/isNumber"),o=require("lodash/filter"),i=require("@nivo/core"),a=require("@react-spring/web"),s=require("react/jsx-runtime");function r(t){return t&&"object"==typeof t&&"default"in t?t:{default:t}}var u=r(n),l=r(e),h=r(o);function d(){return d=Object.assign||function(t){for(var n=1;n<arguments.length;n++){var e=arguments[n];for(var o in e)Object.prototype.hasOwnProperty.call(e,o)&&(t[o]=e[o])}return t},d.apply(this,arguments)}var c={dotSize:4,noteWidth:120,noteTextOffset:8,animate:!0,motionStiffness:90,motionDamping:13},x=function(n){var e=typeof n;return t.isValidElement(n)||"string"===e||"function"===e||"object"===e},f=function(t){var n=typeof t;return"string"===n||"function"===n},m=function(t){return"circle"===t.type},y=function(t){return"dot"===t.type},g=function(t){return"rect"===t.type},p=function(t){var n=t.data,e=t.annotations,o=t.getPosition,i=t.getDimensions;return e.reduce((function(t,e){var a=e.offset||0;return[].concat(t,h.default(n,e.match).map((function(t){var n=o(t),s=i(t);return(m(e)||g(e))&&(s.size=s.size+2*a,s.width=s.width+2*a,s.height=s.height+2*a),d({},u.default(e,["match","offset"]),n,s,{size:e.size||s.size,datum:t})})))}),[])},k=function(t,n,e,o){var a=Math.atan2(o-n,e-t);return i.absoluteAngleDegrees(i.radiansToDegrees(a))},W=function(t){var n,e,o=t.x,a=t.y,s=t.noteX,r=t.noteY,u=t.noteWidth,h=void 0===u?c.noteWidth:u,d=t.noteTextOffset,x=void 0===d?c.noteTextOffset:d;if(l.default(s))n=o+s;else{if(void 0===s.abs)throw new Error("noteX should be either a number or an object containing an 'abs' property");n=s.abs}if(l.default(r))e=a+r;else{if(void 0===r.abs)throw new Error("noteY should be either a number or an object containing an 'abs' property");e=r.abs}var f=o,y=a,p=k(o,a,n,e);if(m(t)){var W=i.positionFromAngle(i.degreesToRadians(p),t.size/2);f+=W.x,y+=W.y}if(g(t)){var v=Math.round((p+90)/45)%8;0===v&&(y-=t.height/2),1===v&&(f+=t.width/2,y-=t.height/2),2===v&&(f+=t.width/2),3===v&&(f+=t.width/2,y+=t.height/2),4===v&&(y+=t.height/2),5===v&&(f-=t.width/2,y+=t.height/2),6===v&&(f-=t.width/2),7===v&&(f-=t.width/2,y-=t.height/2)}var b=n,w=n;return(p+90)%360>180?(b-=h,w-=h):w+=h,{points:[[f,y],[n,e],[w,e]],text:[b,e-x],angle:p+90}},v=function(n){return t.useMemo((function(){return W(n)}),[n])},b=function(n){var e=n.datum,o=n.x,r=n.y,l=n.note,h=i.useTheme(),c=i.useMotionConfig(),x=c.animate,f=c.config,m=a.useSpring({x:o,y:r,config:f,immediate:!x});return"function"==typeof l?t.createElement(l,{x:o,y:r,datum:e}):s.jsxs(s.Fragment,{children:[h.annotations.text.outlineWidth>0&&s.jsx(a.animated.text,{x:m.x,y:m.y,style:d({},h.annotations.text,{strokeLinejoin:"round",strokeWidth:2*h.annotations.text.outlineWidth,stroke:h.annotations.text.outlineColor}),children:l}),s.jsx(a.animated.text,{x:m.x,y:m.y,style:u.default(h.annotations.text,["outlineWidth","outlineColor"]),children:l})]})},w=function(n){var e=n.points,o=n.isOutline,r=void 0!==o&&o,u=i.useTheme(),l=t.useMemo((function(){var t=e[0];return e.slice(1).reduce((function(t,n){return t+" L"+n[0]+","+n[1]}),"M"+t[0]+","+t[1])}),[e]),h=i.useAnimatedPath(l);if(r&&u.annotations.link.outlineWidth<=0)return null;var c=d({},u.annotations.link);return r&&(c.strokeLinecap="square",c.strokeWidth=u.annotations.link.strokeWidth+2*u.annotations.link.outlineWidth,c.stroke=u.annotations.link.outlineColor),s.jsx(a.animated.path,{fill:"none",d:h,style:c})},j=function(t){var n=t.x,e=t.y,o=t.size,r=i.useTheme(),u=i.useMotionConfig(),l=u.animate,h=u.config,c=a.useSpring({x:n,y:e,radius:o/2,config:h,immediate:!l});return s.jsxs(s.Fragment,{children:[r.annotations.outline.outlineWidth>0&&s.jsx(a.animated.circle,{cx:c.x,cy:c.y,r:c.radius,style:d({},r.annotations.outline,{fill:"none",strokeWidth:r.annotations.outline.strokeWidth+2*r.annotations.outline.outlineWidth,stroke:r.annotations.outline.outlineColor})}),s.jsx(a.animated.circle,{cx:c.x,cy:c.y,r:c.radius,style:r.annotations.outline})]})},C=function(t){var n=t.x,e=t.y,o=t.size,r=void 0===o?c.dotSize:o,u=i.useTheme(),l=i.useMotionConfig(),h=l.animate,x=l.config,f=a.useSpring({x:n,y:e,radius:r/2,config:x,immediate:!h});return s.jsxs(s.Fragment,{children:[u.annotations.outline.outlineWidth>0&&s.jsx(a.animated.circle,{cx:f.x,cy:f.y,r:f.radius,style:d({},u.annotations.outline,{fill:"none",strokeWidth:2*u.annotations.outline.outlineWidth,stroke:u.annotations.outline.outlineColor})}),s.jsx(a.animated.circle,{cx:f.x,cy:f.y,r:f.radius,style:u.annotations.symbol})]})},z=function(t){var n=t.x,e=t.y,o=t.width,r=t.height,u=i.useTheme(),l=i.useMotionConfig(),h=l.animate,c=l.config,x=a.useSpring({x:n-o/2,y:e-r/2,width:o,height:r,config:c,immediate:!h});return s.jsxs(s.Fragment,{children:[u.annotations.outline.outlineWidth>0&&s.jsx(a.animated.rect,{x:x.x,y:x.y,width:x.width,height:x.height,style:d({},u.annotations.outline,{fill:"none",strokeWidth:u.annotations.outline.strokeWidth+2*u.annotations.outline.outlineWidth,stroke:u.annotations.outline.outlineColor})}),s.jsx(a.animated.rect,{x:x.x,y:x.y,width:x.width,height:x.height,style:u.annotations.outline})]})},P=function(t,n){n.forEach((function(n,e){var o=n[0],i=n[1];0===e?t.moveTo(o,i):t.lineTo(o,i)}))};exports.Annotation=function(t){var n=t.datum,e=t.x,o=t.y,i=t.note,a=v(t);if(!x(i))throw new Error("note should be a valid react element");return s.jsxs(s.Fragment,{children:[s.jsx(w,{points:a.points,isOutline:!0}),m(t)&&s.jsx(j,{x:e,y:o,size:t.size}),y(t)&&s.jsx(C,{x:e,y:o,size:t.size}),g(t)&&s.jsx(z,{x:e,y:o,width:t.width,height:t.height}),s.jsx(w,{points:a.points}),s.jsx(b,{datum:n,x:a.text[0],y:a.text[1],note:i})]})},exports.bindAnnotations=p,exports.computeAnnotation=W,exports.defaultProps=c,exports.getLinkAngle=k,exports.isCanvasNote=f,exports.isCircleAnnotation=m,exports.isDotAnnotation=y,exports.isRectAnnotation=g,exports.isSvgNote=x,exports.renderAnnotationsToCanvas=function(t,n){var e=n.annotations,o=n.theme;0!==e.length&&(t.save(),e.forEach((function(n){if(!f(n.note))throw new Error("note is invalid for canvas implementation");o.annotations.link.outlineWidth>0&&(t.lineCap="square",t.strokeStyle=o.annotations.link.outlineColor,t.lineWidth=o.annotations.link.strokeWidth+2*o.annotations.link.outlineWidth,t.beginPath(),P(t,n.computed.points),t.stroke(),t.lineCap="butt"),m(n)&&o.annotations.outline.outlineWidth>0&&(t.strokeStyle=o.annotations.outline.outlineColor,t.lineWidth=o.annotations.outline.strokeWidth+2*o.annotations.outline.outlineWidth,t.beginPath(),t.arc(n.x,n.y,n.size/2,0,2*Math.PI),t.stroke()),y(n)&&o.annotations.symbol.outlineWidth>0&&(t.strokeStyle=o.annotations.symbol.outlineColor,t.lineWidth=2*o.annotations.symbol.outlineWidth,t.beginPath(),t.arc(n.x,n.y,n.size/2,0,2*Math.PI),t.stroke()),g(n)&&o.annotations.outline.outlineWidth>0&&(t.strokeStyle=o.annotations.outline.outlineColor,t.lineWidth=o.annotations.outline.strokeWidth+2*o.annotations.outline.outlineWidth,t.beginPath(),t.rect(n.x-n.width/2,n.y-n.height/2,n.width,n.height),t.stroke()),t.strokeStyle=o.annotations.link.stroke,t.lineWidth=o.annotations.link.strokeWidth,t.beginPath(),P(t,n.computed.points),t.stroke(),m(n)&&(t.strokeStyle=o.annotations.outline.stroke,t.lineWidth=o.annotations.outline.strokeWidth,t.beginPath(),t.arc(n.x,n.y,n.size/2,0,2*Math.PI),t.stroke()),y(n)&&(t.fillStyle=o.annotations.symbol.fill,t.beginPath(),t.arc(n.x,n.y,n.size/2,0,2*Math.PI),t.fill()),g(n)&&(t.strokeStyle=o.annotations.outline.stroke,t.lineWidth=o.annotations.outline.strokeWidth,t.beginPath(),t.rect(n.x-n.width/2,n.y-n.height/2,n.width,n.height),t.stroke()),"function"==typeof n.note?n.note(t,{datum:n.datum,x:n.computed.text[0],y:n.computed.text[1],theme:o}):(t.font=o.annotations.text.fontSize+"px "+o.annotations.text.fontFamily,t.fillStyle=o.annotations.text.fill,t.strokeStyle=o.annotations.text.outlineColor,t.lineWidth=2*o.annotations.text.outlineWidth,o.annotations.text.outlineWidth>0&&(t.lineJoin="round",t.strokeText(n.note,n.computed.text[0],n.computed.text[1]),t.lineJoin="miter"),t.fillText(n.note,n.computed.text[0],n.computed.text[1]))})),t.restore())},exports.useAnnotations=function(n){var e=n.data,o=n.annotations,i=n.getPosition,a=n.getDimensions;return t.useMemo((function(){return p({data:e,annotations:o,getPosition:i,getDimensions:a})}),[e,o,i,a])},exports.useComputedAnnotation=v,exports.useComputedAnnotations=function(n){var e=n.annotations;return t.useMemo((function(){return e.map((function(t){return d({},t,{computed:W(d({},t))})}))}),[e])};
//# sourceMappingURL=nivo-annotations.cjs.js.map
